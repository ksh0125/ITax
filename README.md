# 🏛️ 부가가치세법 RAG 검색 시스템

AI 기반 부가가치세법 조문 검색 시스템입니다.

## 📋 프로젝트 구조

```
VAT_RAG_System/
├── vat_preprocessor.py      # 1단계: 법조문 전처리 및 벡터화
├── vat_vector_search.py     # 2단계: 벡터 검색 엔진
├── vat_rag.py              # 3단계: RAG 서비스
├── main.py                 # 4단계: FastAPI 서버
├── index.html              # 5단계: 웹 인터페이스
├── vat_law_processed.pkl   # 전처리된 벡터 데이터 (생성됨)
└── 부가가치세법.docx        # 원본 법조문 (업로드한 파일)
```

## 🚀 설치 및 실행

### 1단계: 필수 패키지 설치

```bash
pip install fastapi uvicorn sentence-transformers torch scikit-learn numpy
```

### 2단계: 데이터 전처리

```bash
python vat_preprocessor.py
```

이 단계에서:
- 부가가치세법 조문을 추출하고 청킹
- AI 모델로 벡터화
- `vat_law_processed.pkl` 파일 생성

### 3단계: 서버 실행

```bash
python main.py
```

서버가 실행되면:
- 🌐 웹 서버: http://127.0.0.1:8000
- 📚 API 문서: http://127.0.0.1:8000/docs
- 🔄 대화형 문서: http://127.0.0.1:8000/redoc

### 4단계: 웹 인터페이스 사용

브라우저에서 `index.html` 파일을 열어서 사용합니다.

## 🎯 주요 기능

### 1. 조문 검색
- **입력**: 검색 키워드 (예: "부가가치세 세율", "사업자 정의")
- **출력**: 관련도 높은 조문들을 유사도 순으로 정렬

### 2. 관련 조문 검색  
- **입력**: 조문 번호 (예: "제30조", "제1조")
- **출력**: 해당 조문과 유사한 다른 조문들

### 3. 시스템 통계
- 총 청크 수, 조문 수, 임베딩 차원 등 시스템 정보

## 🔧 API 엔드포인트

### POST /search-law
조문 검색

```json
{
  "keywords": "부가가치세 세율",
  "max_results": 5
}
```

### POST /related-articles  
관련 조문 검색

```json
{
  "article_number": "제30조",
  "max_results": 3
}
```

### GET /statistics
시스템 통계 조회

### GET /health
서버 상태 확인

## 🧪 테스트 방법

### 1. 벡터 검색 엔진 테스트
```bash
python vat_vector_search.py
```

### 2. RAG 서비스 테스트  
```bash
python vat_rag.py
```

### 3. API 테스트
```bash
curl -X POST "http://127.0.0.1:8000/search-law" \
     -H "Content-Type: application/json" \
     -d '{"keywords": "부가가치세 세율"}'
```

## 📊 샘플 검색어

- **세율 관련**: "부가가치세 세율", "10퍼센트"
- **정의 관련**: "사업자 정의", "재화", "용역"  
- **의무 관련**: "납세의무자", "신고", "납부"
- **절차 관련**: "세금계산서", "신고기한"

## 🎨 웹 인터페이스 특징

- **반응형 디자인**: 모바일/데스크톱 지원
- **탭 인터페이스**: 조문 검색 / 관련 조문 / 시스템 정보
- **실시간 검색**: 키워드 입력 시 즉시 검색
- **유사도 표시**: 검색 결과의 정확도를 %로 표시
- **추천 검색어**: 클릭 한 번으로 샘플 검색

## 🔍 검색 알고리즘

1. **텍스트 임베딩**: 한국어 SBERT 모델 사용
2. **유사도 계산**: 코사인 유사도 기반
3. **결과 집계**: 조문별로 청크들을 그룹화
4. **랭킹**: 최대 유사도 기준으로 정렬

## ⚡ 성능 최적화

- **모델 캐싱**: 서버 시작 시 한 번만 모델 로딩
- **벡터 미리 계산**: 사전에 모든 조문을 벡터화
- **청킹 전략**: 의미 단위로 효율적 분할
- **메모리 최적화**: NumPy 행렬 기반 벡터 연산

## 🚨 문제 해결

### 서버가 시작되지 않는 경우
```bash
# 필수 패키지 재설치
pip install --upgrade fastapi uvicorn sentence-transformers torch

# 데이터 파일 확인
ls -la vat_law_processed.pkl
```

### 검색 결과가 없는 경우
1. 전처리 데이터 확인: `python vat_preprocessor.py` 재실행
2. 검색어 변경: 더 구체적이거나 다른 키워드 시도
3. 유사도 임계값 조정: 코드에서 `similarity_threshold` 낮추기

### 웹 인터페이스 연결 안되는 경우
1. 서버 실행 확인: http://127.0.0.1:8000/health 접속
2. CORS 설정 확인: 브라우저 콘솔 에러 메시지 확인
3. 포트 충돌: 다른 포트로 서버 실행

## 📈 확장 가능성

- **다른 법령 추가**: 소득세법, 법인세법 등
- **LLM 통합**: GPT, Claude 등과 연동하여 답변 생성
- **고급 검색**: 조건부 검색, 범위 검색 등
- **사용자 인증**: 로그인, 검색 기록 관리
- **API 확장**: RESTful API 완전 지원

## 📞 지원

문제가 발생하면 다음을 확인해보세요:

1. **로그 확인**: 터미널에서 에러 메시지 확인
2. **의존성 확인**: 필수 패키지가 설치되어 있는지 확인  
3. **파일 위치**: 모든 파일이 같은 폴더에 있는지 확인
4. **권한 문제**: 파일 읽기/쓰기 권한 확인

---

🎉 **부가가치세법 RAG 검색 시스템을 성공적으로 구축했습니다!**